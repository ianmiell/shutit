---
layout: default
markdown: 0
---
<a href="https://github.com/ianmiell/shutit/fork">
  <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub">
</a>
<div class='jumbotron'>
  <div>
  <h1>ShutIt</h1>
  <p>Configuration management for the future.</p>
  </div>
</div>
<div class='row'>
  <div class='col-md-1'></div>
  <div class='col-md-10'>
    <p><h1>Why?</h1></p>
    <p class='lead'>Interested in Docker? Find Dockerfiles limiting?</p>
    <p class='lead'>Are you a programmer annoyed by the obfuscation and indirection Chef/Puppet/Ansible brings to a simple series of commands?</p>
    <p class='lead'>Interested in stable stateless deployments?</p>
    <p class='lead'>Join us!</p>
        <h1>Features</h1>
        <ul>
          <li>Easy to use</li>
          <li>Deterministic builds</li>
          <li>Outputs include a series of shell commands you can port to other CM tools</li>
          <li>Automate your pushing and deployment in one place</li>
          <li>Shell-based (minimal learning curve)</li>
          <li>Implement your own tests of modules that are automatically run</li>
          <li>Use your python skills to make it work the way you want</li>
          <li>Extensive debugging tools to make reproducible builds easier</li>
          <li>Util functions for common tasks (that work across distros)</li>
        </ul>
      </div>
      <div class='col-md-1'></div>
    </div>
    <div class='row'>
      <div class='col-md-1'></div>
      <div class="col-md-10">
        <section>
          <h3>Step 1: Get the source</h3>
          <pre data-language='shell'>
git clone https://github.com/ianmiell/shutit</pre>
        </section>
        <section>
          <h3>Step 2: Create a new module</h3>
          <pre data-language='shell'>
cd shutit/bin
./create_skeleton.sh /home/username/shutit_modules/shutit_module shutit_module
cd /home/username/shutit_modules/shutit_module</pre>
          <p>Folder structure:</p>
          <ul>
            <li><p><strong>/bin</strong> - scripts for this module <em>(see example below)</em></p></li>
            <li><p><strong>/configs</strong> - config for your module <em>(see example below)</em></p></li>
            <li><p><strong>/resources</strong> - files needed that are too big for source control <em>(see example below)</em></p></li>
          </ul>
          <br />
          <p>An example folder structure:</p>
          <pre data-language='shell'>
./shutit_module
├──  bin
│   ├── create_skeleton.sh
│   ├── README.md
│   └── test.sh
├── build.sh
├── configs
│   ├── build.cnf
│   └── defaults.cnf
├── README.md
├── resources
│   └── README.md
└── run.sh</pre>
</section>
       </div>
      <div class='col-md-1'></div>
     </div>
    <div class='row'>
      <div class='col-md-1'></div>
      <div class="col-md-10">
        <section>
          <h3>Step 3: Modify the default module</h3>
          <p>The default module contains examples of many common tasks when installing, eg</p>
          <ul>
            <li>util.install                               - installs packages based on distro (eg 'passwd' install in shutit_module.py)</li>
            <li>password handling                          - automate the inputting of passwords (eg 'passwd' install in shutit_module.py)</li>
            <li>config to set up apps                      - (eg 'passwd' install in shutit_module.py)</li>
            <li>add line to file                           - automate the input-ing of passwords</li>
            <li>util.pause_point                           - to allow you to stop during a build and inspect before continuing</li>
            <li>handle logins/logouts                      - to make for safer automated interactions with eg unexpected prompts</li>
            <li>pull resources in and out of the container - for objects too big for source control</li>
          </ul>
          <p>It also gives a simple example of each part of the build lifecycle. <strong>Add a package to install to shutit_module.py</strong></p>
          <pre data-language='shell'>
                # Make sure passwd is installed
                util.install(container_child,config_dict,'passwd',root_prompt_expect)
                # Install mlocate
    util.install(container_child,config_dict,'mlocate',root_prompt_expect)

    # Install added by you
    util.install(container_child,config_dict,'your chosen package here',root_prompt_expect)
          </pre>
          <p><strong>Running the module requires that in your shutit_module.py, shutit_module(string,float) is set:</strong></p>
          <ul>
            <li><strong>string</strong> is a python string that is not likely to clash, eg <strong>'com.mydomain.mysubmodule.myref'</strong> (including quotes)</li>
            <li><strong>float</strong> is a unique decimal value that is not clashing with any other modules, and defines the order in which they are built</li>
          </ul>
          <p><strong>Change the above and save the file</strong></p>
          <pre data-language='shell'>
$ grep -rnwl com.mycorp.shutit_module *
configs/build.cnf
configs/defaults.cnf
[...]</pre>
          <p><strong>Replace references to com.mycorp.shutit_module with your chosen string in the above files</strong></p>
        </section>
      </div>
    </div> 
    <div class='row'>
      <div class='col-md-1'></div>
      <div class="col-md-10">
          <h3>Step 4: Build your module</h3>
      <pre data-language='shell'>
$ ./build.sh
ERROR!
Files are not secure, mode should be 0600. Run the following commands to correct:

chmod 0600 [...]/defaults.cnf</pre>
    <p><strong>Secure your files:</strong></p>
    <pre data-language='shell'>
chmod 0600 configs/defaults.cnf</pre>
    <p><strong>Build module:</strong></p>
    <pre data-language='shell'>
$ ./build.sh
SHUTIT_BACKUP_PS1=$PS1 && unset PROMPT_COMMAND && PS1="SHUTIT_PROMPT_REAL_USER#195886238"
SHUTIT_BACKUP_PS1=$PS1 && unset PROMPT_COMMAND && PS1="SHUTIT_PROMPT_REAL_USER#195886238"
set PROMPT_COMMAND && PS1="SHUTIT_PROMPT_REAL_USER#195886238"CKUP_PS1=$PS1 && un 
SHUTIT_PROMPT_REAL_USER#195886238SHUTIT_BACKUP_PS1=$PS1 && unset PROMPT_COMMAND && PS1="SHUTIT_PROMPT_PRE_BUILD#1454501189"
PT_PRE_BUILD#1454501189"& unset PROMPT_COMMAND && PS1="SHUTIT_PROM</pre>
      </div>
      <div class='col-md-1'></div>
    </div>
    <div class='row'>
      <div class='col-md-1'></div>
      <div class="col-md-10">
          <h3>Step 5: Run your module</h3>
      <pre data-language='shell'>
$ ./run.sh
root@138ed0fd3728:/#
</pre>
          <p>You are now in your bespoke container!</p>
      </div>
      <div class='col-md-1'></div>
    </div>
    <div class='row'>
      <div class='col-md-1'></div>
      <div class="col-md-10">
    <h3>Step 6: Mix and match</h3>
    <p>Let's add mysql to the container build. Change this in your <strong>shutit_module.py:</strong></p>
    <pre data-language='shell'>
        obj.add_dependency('shutit.tk.setup')
    </pre>
          <p>to:</p>
          <pre data-language='shell'>
        obj.add_dependency('shutit.tk.setup')
        obj.add_dependency('shutit.tk.mysql.mysql')
          </pre>
          <p>And change the <strong>build.sh</strong></p>
          <pre data-language='shell'>
python /tmp/a/shutit/bin/../shutit_main.py --shutit_module_path /your/path/to/shutit/example/mysql
          </pre>
          <p>And change the <strong>configs/build.sh</strong>, adding</p>
          <pre data-language='shell'>
[shutit.tk.mysql.mysql]
build:yes
          </pre>
          <p>Rebuild and re-run to get the same container with mysql installed.</p>
      </div>
      <div class='col-md-1'></div>
